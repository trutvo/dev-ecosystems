# -*- org-confirm-babel-evaluate: nil -*-
#+TITLE: meta programming

Meta programming is a programming technique in which computer programs have the ability
to treat other programs as their data. This means that a program can be designed to read,
generate, analyze, or transform other programs, and even modify itself while running.

* Lisp

In lisp data and code are represented in the same way: as lists. This makes lisp a powerful language for
meta programming, because lisp programs can easily manipulate other lisp programs.

#+BEGIN_SRC emacs-lisp
  (defvar myfunc (quote (+ 1 3 4)))
  (defvar myfunc2 (append myfunc '(5)))
  (message "data=%s\nexecuted code=%s" myfunc2 (eval myfunc2))
#+END_SRC

#+RESULTS:
: data=(+ 1 3 4 5)
: executed code=13

* Python

In python, meta programming can be achieved using functions that manipulate other functions or classes.

#+BEGIN_SRC python :exports both :results silent :tangle example_meta_programming.py
  class DatabaseConnection:
      def begin(self):
          print("DB: begin transaction")
          pass
      def rollback(self):
          print("DB: rollback transaction")
          pass
      def commit(self):
          print("DB: commit transaction")
          pass

  def transactional(db):
      def decorator(func): 
          def wrapper():
              db.begin()
              try:
                  func()
                  db.commit()
              except Exception as e:
                  db.rollback()
                  raise e
          return wrapper
      return decorator

  db = DatabaseConnection()
      
  @transactional(db)
  def say_hello():
      print("Hello!")
      
  @transactional(db)
  def fail():
      1 / 0

  try:
    print("---")
    say_hello()
    print("---")
    fail()
  except Exception as e:
    print(f"ERROR: Caught exception: {e}")
#+END_SRC
